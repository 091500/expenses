<% provide(:title, 'Money records') %>
<% content_for :main_content do %>

  <% if @moneyrecords.empty? %>

      <div class="alert alert-info" role="alert">
        No records found
      </div>

  <% else %>

    <% sum_income = 0 %>
    <% sum_expense = 0 %>

    <div class="panel panel-default">

      <!-- Default panel contents -->
      <div class="panel-heading clearfix">
        <h3 class="panel-title pull-left">Search records</h3>
      </div>

      <div class="panel-body">
        <%= bootstrap_form_tag url: moneyrecords_path, method: 'get', layout: :inline do |f| %>
            <%= f.date_field :date_from, value: params[:date_from] ? params[:date_from] : Date.today-1.month %>
            <%= f.date_field :date_to, max: Date.today, value: params[:date_to] ? params[:date_to] : Date.today %>
            <%= f.submit 'Search' %>

            <%= f.static_control hide_label: true do %>
                <%= link_to 'Clear form', moneyrecords_path, class: 'btn btn-default' %>
            <% end %>

        <% end %>
      </div>

    </div>


    <div class="panel panel-default">
      <!-- Default panel contents -->
      <div class="panel-heading clearfix">
        <h3 class="panel-title pull-left">Your personal expenses/incomes</h3>
        <%= link_to 'Add new record', new_moneyrecord_path, class: 'btn btn-sm btn-primary pull-right' %>
      </div>

      <!-- Table -->
      <table class="table table-striped">
        <thead>
        <tr>
          <th>Comment</th>
          <th>Category</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Date</th>
          <th colspan="3"></th>
        </tr>
        </thead>
        <tbody>
        <% @moneyrecords.each do |moneyrecord| %>
          <tr>
            <td><%= moneyrecord.name %></td>
            <td><%= moneyrecord.category.name %></td>
            <td><%= moneyrecord.category.record_type == 1 ? 'Income' : 'Expense' %></td>
            <td><%= moneyrecord.amount %></td>
            <td><%= moneyrecord.made_at %></td>
            <td><%= link_to 'Show', moneyrecord %></td>
            <td><%= link_to 'Edit', edit_moneyrecord_path(moneyrecord) %></td>
            <td><%= link_to 'Destroy', moneyrecord, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
          <% sum_income += moneyrecord.amount if moneyrecord.category.record_type == 1 and !moneyrecord.amount.nil? %>
          <% sum_expense += moneyrecord.amount if moneyrecord.category.record_type == 0 and !moneyrecord.amount.nil? %>
        <% end %>
        <tr>
          <td colspan="3">Balance</td>
          <td><%= sum_income-sum_expense %></td>
          <td colspan="4"></td>
        </tr>
        </tbody>
      </table>

    </div>

  <% end %>

<% end %>

<%= render 'layouts/userarea' %>
